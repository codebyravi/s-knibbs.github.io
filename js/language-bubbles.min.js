"use strict";!function(){function t(t){var r=[],n=0,o=d3.schemeCategory10.slice(0).reverse();for(var a in t)n+=t[a];for(var a in t)r.push({name:a,r:Math.atan(3*t[a]/n+.04)*(e/3),percentage:100*t[a]/n});r.sort(function(t,e){return t.percentage-e.percentage});for(var s=0;s<r.length;s++){var i=o.pop();o.unshift(i),r[s].color=i}return d3.packSiblings(r),r}var e=900,r=d3.select("body").append("svg").attr("width",e).attr("height",e);d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.json("/data/language-totals.json",function(n,o){if(n)throw n;var a=r.selectAll(".bubble").data(t(o)).enter().append("g").attr("class","bubble").attr("transform",function(t){return"translate("+(t.x+e/2)+","+(t.y+e/2.5)+")"});a.append("circle").attr("r",function(t){return t.r}).style("fill",function(t){return t.color}).style("stroke","white").style("stroke-width",2),a.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(t){return t.name+" "+t.percentage.toPrecision(3)+"%"}).classed("hide",function(t){return this.getBBox().width>2.5*t.r}),a.on("mouseover",function(){var t=d3.select(this);t.moveToFront();var e=t.select("text").classed("mouseover",!0).node().getBBox(),r=3;t.insert("rect","text").style("fill","rgba(255,255,255,0.5)").attr("x",e.x-r).attr("y",e.y-r).attr("width",e.width+2*r).attr("height",e.height+2*r)}).on("mouseout",function(){d3.select(this).select("text").classed("mouseover",!1),d3.select(this).select("rect").remove()})})}();